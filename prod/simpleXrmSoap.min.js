var simpleXrmSoap={encodeXML:function(n){var t=[],r;for(i=0;i<n.length;i++){r=n.charAt(i);switch(r){case"<":t.push("&lt;");break;case">":t.push("&gt;");break;case"&":t.push("&amp;");break;case'"':t.push("&quot;");break;case"'":t.push("&#39;");break;default:r<" "||r>"~"?t.push("&#"+r.charCodeAt(0)+";"):t.push(r)}}return t.join("")},decodeXML:function(n){return typeof n!="string"&&(n=n.toString()),n},request:function(n){var i=Xrm.Page.context.getClientUrl()+"/XRMServices/2011/Organization.svc/web",t;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)t=new ActiveXObject("Microsoft.XMLHTTP");else return simpleXrm.error("We encountered an unexpected issue. Please check your form data before proceeding. Info for Admin: User's browser may not support one of the requested scripts. Please attempt using FireFox or IE 8+"),null;t.open("POST",encodeURI(i),!0);t.setRequestHeader("Accept","application/xml, text/xml, */*");t.setRequestHeader("Content-Type","text/xml; charset=utf-8");t.setRequestHeader("SOAPAction","http://schemas.microsoft.com/xrm/2011/Contracts/Services/IOrganizationService/Execute");t.onreadystatechange=n.callback;t.send(n.request)},normalizeResults:function(n){var t,i;return n.responseText&&(window.DOMParser?(i=new DOMParser,t=i.parseFromString(n.responseText,"text/xml")):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(n.responseText))),t},getRetrieveMultipleResults:function(n){var t=null;return simpleXrmSoap.parseOnReady(n)&&(t=simpleXrmSoap.parseFetchResponse(simpleXrmSoap.normalizeResults(n))),t},parseFetchResponse:function(n){var u,t,i,e,r;if(n=n.getElementsByTagName("ExecuteResult"),n&&n[0]&&(n=n[0],n.childNodes&&n.childNodes[0]&&n.childNodes.length===2&&n.childNodes&&n.childNodes[0]&&n.childNodes[0].childNodes&&n.childNodes[0].childNodes[0]&&n.childNodes[0].childNodes[0].nodeValue==="RetrieveMultiple"&&(n=n.childNodes[1],n.childNodes&&n.childNodes[0]&&n.childNodes[0].localName==="KeyValuePairOfstringanyType"&&(n=n.childNodes[0],n.childNodes&&n.childNodes.length===2&&n.childNodes[0].localName==="key"&&n.childNodes[0].childNodes[0].nodeValue==="EntityCollection"&&n.childNodes[1].localName==="value"&&(n=n.childNodes[1],n.childNodes[1]&&n.childNodes[1].childNodes&&(n=n.childNodes[0],n.childNodes&&n.childNodes&&n.childNodes.length>0))))))for(u=[],t=0;t<n.childNodes.length;t++){var o=n.childNodes[t].childNodes[3],s=n.childNodes[t].childNodes[5],f={attributes:{},id:o.childNodes[0].nodeValue,logicalName:s.childNodes[0].nodeValue,relatedEntities:[]};for(i=0;i<n.childNodes[t].childNodes[0].childNodes.length;i++)e=n.childNodes[t].childNodes[0].childNodes[i].childNodes[0].childNodes[0].nodeValue,r=n.childNodes[t].childNodes[0].childNodes[i].childNodes[1].childNodes[0].nodeValue,!r&&n.childNodes[t].childNodes[0].childNodes[i].childNodes[1]&&n.childNodes[t].childNodes[0].childNodes[i].childNodes[1].childNodes[0]&&n.childNodes[t].childNodes[0].childNodes[i].childNodes[1].childNodes[0].childNodes[0].nodeValue&&(r=n.childNodes[t].childNodes[0].childNodes[i].childNodes[1].childNodes[0].childNodes[0].nodeValue,Number(r)&&(r=Number(r))),f.attributes[e]=r;u.push(f)}return u||console.log("Results could not be returned from the FetchXML Request."),u||null},getFetchResults:function(n){if(simpleXrmSoap.parseOnReady(n)){var t=simpleXrmSoap.normalizeResults(n),i=null;return t&&t.childNodes&&(i=simpleXrmSoap.jsonify(t.childNodes[0])),i}},jsonify:function(n){var u=function(n){var r,u,f,t,e;if(n&&n.childNodes&&n.childNodes.length===2&&(n.childNodes[0].localName==="key"&&n.childNodes[1].localName==="value"||n.childNodes[0].localName==="value"&&n.childNodes[1].localName==="key")){for(r={},t=0,e=n.childNodes.length;t<e;t++)n.childNodes[t].localName==="key"&&n.childNodes[t].childNodes[0]?u=n.childNodes[t].childNodes[0].nodeValue:n.childNodes[t].localName==="value"&&n.childNodes[t].childNodes[0]&&(f=i(n.childNodes[t].childNodes[0]));return r[u]=f,r}},r=function(n){return n.__proto__.constructor===Array||n.constructor===Array||n.constructor===HTMLCollection||n.__proto__.constructor===HTMLCollection},f=function(n){return n.__proto__.constructor===Object||n.constructor===Object||n.constructor===HTMLElement||n.__proto__.constructor===HTMLElement},i=function(n){var f={},t,e,s,o;if(n&&n.localName&&n.localName==="KeyValuePairOfstringanyType")f=u(n);else if(n&&n.localName&&n.localName==="value"&&n.nodeValue)f=n.nodeValue;else if(n&&n.localName&&n.childNodes){for(t=[],e=0,s=n.childNodes.length;e<s;e++)t.push(i(n.childNodes[e]));for(o=0;o<10&&t&&r(t)&&t.length===1;)t=t[0],o++;f[n.localName]=t}else n&&n.localName&&n.nodeValue?f[n.localName]=n.nodeValue:n&&!n.localName&&n.nodeValue?f=n.nodeValue:n&&r(n)&&n.length===1&&(f=i(n[0]));return f},e=function(n){var u={},t,e,i;if(r(n)&&n.length>0){for(t=0,e=n.length;t<e;t++)if(f(n[t]))for(i in n[t])u[i]=n[t][i];return u}},o=function(n){var t={};return n&&n.Entities&&n.Entities.Entity?t=[n.Entities.Entity]:n&&n.Entities&&r(n)&&n.Entities.length>0?t=n.Entities:console.log("Something unexpected happened."),t},s=function(n){var i=[],t,r,u;if(n&&(n.constructor===Array||n.constructor===HTMLCollection)&&n.length>0)for(t=0,r=n.length;t<r;t++)u=h(n[t]),i.push(u);return i},h=function(n){var u={},t,f,r;if(n.constructor===Array||n.constructor===HTMLCollection){for(t=0,f=n.length;t<f;t++)if(n[t].Attributes)u.attributes=e(n[t].Attributes);else if(n[t].constructor===Object||n[t].constructor===HTMLElement)for(r in n[t])u[r]=i(n[t][r])}else if(n.constructor===Object||n.constructor===HTMLElement)for(r in n)u[r]=i(n[r]);return u},t=n.getElementsByTagName("a:Entities");return t&&(t=i(t)),t=o(t),t=s(t),t||null},retrieveMultiple:function(n){var t=simpleXrmSoap.encodeXML(n.fetch),i;t=t.replace(/\"/g,"'");i="<?xml version=\"1.0\" encoding=\"utf-8\"?><s:Envelope xmlns:s=\"http://schemas.xmlsoap.org/soap/envelope/\"><s:Body><RetrieveMultiple xmlns='http://schemas.microsoft.com/crm/2007/WebServices'><query xmlns:q1='http://schemas.microsoft.com/crm/2006/Query' xsi:type='q1:QueryExpression'>"+n.query+"<\/query><\/RetrieveMultiple><\/s:Body><\/s:Envelope>";simpleXrmSoap.request({request:i,callback:n.callback})},fetch:function(n){var t=simpleXrmSoap.encodeXML(n.fetch),i;t=t.replace(/\"/g,"'");i="<s:Envelope xmlns:s='http://schemas.xmlsoap.org/soap/envelope/'><s:Body><Execute xmlns='http://schemas.microsoft.com/xrm/2011/Contracts/Services'><request i:type='b:RetrieveMultipleRequest' xmlns:b='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:i='http://www.w3.org/2001/XMLSchema-instance'><b:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic'><b:KeyValuePairOfstringanyType><c:key>Query<\/c:key><c:value i:type='b:FetchExpression'><b:Query>"+t+"<\/b:Query><\/c:value><\/b:KeyValuePairOfstringanyType><\/b:Parameters><b:RequestId i:nil='true' /><b:RequestName>RetrieveMultiple<\/b:RequestName><\/request><\/Execute><\/s:Body><\/s:Envelope>";simpleXrmSoap.request({request:i,callback:n.callback})},retrieveDependentComponents:function(n){var t='<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Body><Execute xmlns="http://schemas.microsoft.com/xrm/2011/Contracts/Services" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><request i:type="b:RetrieveDependenciesForDeleteRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts" xmlns:b="http://schemas.microsoft.com/crm/2011/Contracts"><a:Parameters xmlns:c="http://schemas.datacontract.org/2004/07/System.Collections.Generic"><a:KeyValuePairOfstringanyType><c:key>ObjectId<\/c:key><c:value i:type="d:guid" xmlns:d="http://schemas.microsoft.com/2003/10/Serialization/">'+n.id+'<\/c:value><\/a:KeyValuePairOfstringanyType><a:KeyValuePairOfstringanyType><c:key>ComponentType<\/c:key><c:value i:type="d:int" xmlns:d="http://www.w3.org/2001/XMLSchema">1<\/c:value><\/a:KeyValuePairOfstringanyType><\/a:Parameters><a:RequestId i:nil="true" /><a:RequestName>RetrieveDependenciesForDelete<\/a:RequestName><\/request><\/Execute><\/s:Body><\/s:Envelope>';simpleXrmSoap.request({request:t,callback:n.callback})},setStatus:function(n){var t='<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Body><Execute xmlns="http://schemas.microsoft.com/xrm/2011/Contracts/Services" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><request i:type="b:SetStateRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts" xmlns:b="http://schemas.microsoft.com/crm/2011/Contracts"><a:Parameters xmlns:c="http://schemas.datacontract.org/2004/07/System.Collections.Generic"><a:KeyValuePairOfstringanyType><c:key>EntityMoniker<\/c:key><c:value i:type="a:EntityReference"><a:Id>'+n.record.id+"<\/a:Id><a:LogicalName>"+n.record.entityName+'<\/a:LogicalName><a:Name i:nil="true" /><\/c:value><\/a:KeyValuePairOfstringanyType><a:KeyValuePairOfstringanyType><c:key>State<\/c:key><c:value i:type="a:OptionSetValue"><a:Value>'+n.stateCode+'<\/a:Value><\/c:value><\/a:KeyValuePairOfstringanyType><a:KeyValuePairOfstringanyType><c:key>Status<\/c:key><c:value i:type="a:OptionSetValue"><a:Value>'+n.statusCode+'<\/a:Value><\/c:value><\/a:KeyValuePairOfstringanyType><\/a:Parameters><a:RequestId i:nil="true" /><a:RequestName>SetState<\/a:RequestName><\/request><\/Execute><\/s:Body><\/s:Envelope>';simpleXrmSoap.request({request:t,callback:n.callback})},parseOnReady:function(n){var t=!1;return n.readyState===4&&n.status===200&&(n.onreadystatechange=null,t=!0),t},runWorkflow:function(n){var t='<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Body><Execute xmlns="http://schemas.microsoft.com/xrm/2011/Contracts/Services" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><request xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts"><a:Parameters xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic"><a:KeyValuePairOfstringanyType><b:key>EntityId<\/b:key><b:value i:type="d:guid" xmlns:d="http://schemas.microsoft.com/2003/10/Serialization/">'+n.target.id+'<\/b:value><\/a:KeyValuePairOfstringanyType><a:KeyValuePairOfstringanyType><b:key>WorkflowId<\/b:key><b:value i:type="d:guid" xmlns:d="http://schemas.microsoft.com/2003/10/Serialization/">'+n.workflow.id+'<\/b:value><\/a:KeyValuePairOfstringanyType><\/a:Parameters><a:RequestId i:nil="true" /><a:RequestName>ExecuteWorkflow<\/a:RequestName><\/request><\/Execute><\/s:Body><\/s:Envelope>';simpleXrmSoap.request({request:t,callback:n.callback})}};